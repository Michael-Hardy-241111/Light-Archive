# 数据结构

## 结构

### 文件头

文件头占用20字节。

| 字节 | 描述（固定值） | 长度 |
| --- | --- | --- |
| 0 | 魔数（'L','A','R','C'） | 4 |
| 4 | 主版本号 | 1 |
| 5 | 次版本号 | 1 |
| 6 | 加密标志 | 1 |
| 7 | 压缩标志 | 1 |
| 8 | 文件列表偏移 | 2 |
| 10 | 文件数量 | 2 |
| 12 | .larc文件总长度 | 8 |

### 文件列表

每个文件的信息在文件列表里占16字节。

| 字节 | 描述 | 长度 |
| --- | --- | --- |
| 0 | 序号 | 2 |
| 2 | 文件名长度 | 2 |
| 4 | 文件长度 | 4 |
| 8 | 文件偏移 | 8 |

### 额外数据

位置：文件头之后至文件列表之前（数据头）、内部文件前后的未使用区域、所有内部文件之后至文件尾（数据尾）。

注意：额外数据长度不定，位置不定，没有固定格式，主要作用是保存额外信息，如文件注释、文件创建时间等。

### 内部文件

每个文件占用的空间已在[文件列表](#文件列表)中记录。

> 结构：文件名（无'\0'） + 文件内容

### 文件尾

文件尾占用6字节，分为错误识别码、错误识别码模式和结束标识。

**错误识别码**长32位，是用于识别文件是否有误的数据。实现方法如下：

1. 在文件列表前8个字节读取第一个64为无符号整数，在文件列表后8个字节读取第二个64位无符号整数。
2. 以这两个整数为偏移读取两个不固定位置的32位有符号整数。
3. 读取错误识别码模式。
4. 根据错误识别码模式计算错误识别码。
5. 比较计算出的错误识别码与文件尾的错误识别码是否相等。

**错误识别码模式**占用1字节，用于指定计算错误识别码的方法。下面是错误识别码模式的取值：

| 值 | 描述 |
| --- | --- |
| 0 | 无操作 |
| 1 | 加法 |
| 2 | 减法 |
| 3 | 反转符号 |
| 4 | 乘法（取低位） |
| 5 | 乘法（取高位） |
| 6 | 除法（取商） |
| 7 | 除法（取余） |
| 8 | 取第一个数 |
| 9 | 第一个数取反（NOT） |
| 10 | 按位与（AND） |
| 11 | 按位与非（NAND） |
| 12 | 按位或（OR） |
| 13 | 按位或非（NOR） |
| 14 | 按位异或（XOR） |
| 15 | 按位同或（XNOR） |

把模式分成高4位和低4位，分别处理两个整数。将处理后得到的数按位同或得到最终的错误识别码。

**结束标识**占用1字节，固定值为0x03，就是ASCII字符ETX。

## 加密

> 目前未设计加密处理。

## 压缩

> 目前未设计压缩处理。

## 备注

额外数据部分可以通过larcShowOtherData函数获取，用户可以自行查看，可以作为人工错误识别的依据。

额外数据部分可以通过larcSetOtherData函数设置。

> 注意：设置额外数据后，文件尾的错误识别码会改变，需要重新计算。
